var app=function(){"use strict";function e(){}function t(e,t){for(const n in t)e[n]=t[n];return e}function n(e){return e()}function o(){return Object.create(null)}function s(e){e.forEach(n)}function r(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function u(e,t){e.appendChild(t)}function i(e,t,n){e.insertBefore(t,n||null)}function a(e){e.parentNode.removeChild(e)}function p(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function m(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function f(){return d(" ")}function h(){return d("")}function g(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function $(e){return function(t){return t.preventDefault(),e.call(this,t)}}function b(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function v(e,t){t=""+t,e.data!==t&&(e.data=t)}let k;function w(e){k=e}function y(e){(function(){if(!k)throw new Error("Function called outside component initialization");return k})().$$.on_destroy.push(e)}function R(){const e=k;return(t,n)=>{const o=e.$$.callbacks[t];if(o){const s=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);o.slice().forEach(t=>{t.call(e,s)})}}}const x=[],_=[],T=[],j=[],P=Promise.resolve();let S=!1;function C(e){T.push(e)}function N(){const e=new Set;do{for(;x.length;){const e=x.shift();w(e),O(e.$$)}for(;_.length;)_.pop()();for(let t=0;t<T.length;t+=1){const n=T[t];e.has(n)||(n(),e.add(n))}T.length=0}while(x.length);for(;j.length;)j.pop()();S=!1}function O(e){e.fragment&&(e.update(e.dirty),s(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(C))}const U=new Set;let L;function I(){L={r:0,c:[],p:L}}function F(){L.r||s(L.c),L=L.p}function A(e,t){e&&e.i&&(U.delete(e),e.i(t))}function E(e,t,n,o){if(e&&e.o){if(U.has(e))return;U.add(e),L.c.push(()=>{U.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}}function D(e,n){const o=n.token={};function s(e,s,r,c){if(n.token!==o)return;n.resolved=r&&{[r]:c};const l=t(t({},n.ctx),n.resolved),u=e&&(n.current=e)(l);n.block&&(n.blocks?n.blocks.forEach((e,t)=>{t!==s&&e&&(I(),E(e,1,1,()=>{n.blocks[t]=null}),F())}):n.block.d(1),u.c(),A(u,1),u.m(n.mount(),n.anchor),N()),n.block=u,n.blocks&&(n.blocks[s]=u)}if((r=e)&&"object"==typeof r&&"function"==typeof r.then){if(e.then(e=>{s(n.then,1,n.value,e)},e=>{s(n.catch,2,n.error,e)}),n.current!==n.pending)return s(n.pending,0),!0}else{if(n.current!==n.then)return s(n.then,1,n.value,e),!0;n.resolved={[n.value]:e}}var r}function J(e,t,o){const{fragment:c,on_mount:l,on_destroy:u,after_update:i}=e.$$;c.m(t,o),C(()=>{const t=l.map(n).filter(r);u?u.push(...t):s(t),e.$$.on_mount=[]}),i.forEach(C)}function B(e,t){e.$$.fragment&&(s(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function q(e,t){e.$$.dirty||(x.push(e),S||(S=!0,P.then(N)),e.$$.dirty=o()),e.$$.dirty[t]=!0}function H(t,n,r,c,l,u){const i=k;w(t);const a=n.props||{},p=t.$$={fragment:null,ctx:null,props:u,update:e,not_equal:l,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:o(),dirty:null};let m=!1;var d;p.ctx=r?r(t,a,(e,n)=>{p.ctx&&l(p.ctx[e],p.ctx[e]=n)&&(p.bound[e]&&p.bound[e](n),m&&q(t,e))}):a,p.update(),m=!0,s(p.before_update),p.fragment=c(p.ctx),n.target&&(n.hydrate?p.fragment.l((d=n.target,Array.from(d.childNodes))):p.fragment.c(),n.intro&&A(t.$$.fragment),J(t,n.target,n.anchor),N()),w(i)}class M{$destroy(){B(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function W(t){var n,o,s,r;return{c(){n=m("li"),o=m("a"),s=d(t.name),b(o,"href",t.path),b(o,"class","svelte-kazhwj"),r=g(o,"click",$(t.redirectTo))},m(e,t){i(e,n,t),u(n,o),u(o,s)},p(e,t){e.path&&b(o,"href",t.path)},i:e,o:e,d(e){e&&a(n),r()}}}function z(e,t,n){let{selectTab:o,curRoute:s,routes:r,path:c}=t,l=window.location.origin+c,u=r[c].name;return e.$set=(e=>{"selectTab"in e&&n("selectTab",o=e.selectTab),"curRoute"in e&&n("curRoute",s=e.curRoute),"routes"in e&&n("routes",r=e.routes),"path"in e&&n("path",c=e.path)}),{selectTab:o,curRoute:s,routes:r,path:c,name:u,redirectTo:function(e){o(e.target);const t=e.target.pathname;s.set(t),window.history.pushState({path:t},"",l)}}}class G extends M{constructor(e){super(),H(this,e,z,W,c,["selectTab","curRoute","routes","path"])}}function Y(e){var t,n,o=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/local"}}),s=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/federated"}});return{c(){o.$$.fragment.c(),t=f(),s.$$.fragment.c()},m(e,r){J(o,e,r),i(e,t,r),J(s,e,r),n=!0},p(e,t){var n={};e.curRoute&&(n.curRoute=t.curRoute),e.selectTab&&(n.selectTab=t.selectTab),e.routes&&(n.routes=t.routes),o.$set(n);var r={};e.curRoute&&(r.curRoute=t.curRoute),e.selectTab&&(r.selectTab=t.selectTab),e.routes&&(r.routes=t.routes),s.$set(r)},i(e){n||(A(o.$$.fragment,e),A(s.$$.fragment,e),n=!0)},o(e){E(o.$$.fragment,e),E(s.$$.fragment,e),n=!1},d(e){B(o,e),e&&a(t),B(s,e)}}}function Z(e){var t,n,o,s=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/inbox"}}),r=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/create"}}),c=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/search"}});return{c(){s.$$.fragment.c(),t=f(),r.$$.fragment.c(),n=f(),c.$$.fragment.c()},m(e,l){J(s,e,l),i(e,t,l),J(r,e,l),i(e,n,l),J(c,e,l),o=!0},p(e,t){var n={};e.curRoute&&(n.curRoute=t.curRoute),e.selectTab&&(n.selectTab=t.selectTab),e.routes&&(n.routes=t.routes),s.$set(n);var o={};e.curRoute&&(o.curRoute=t.curRoute),e.selectTab&&(o.selectTab=t.selectTab),e.routes&&(o.routes=t.routes),r.$set(o);var l={};e.curRoute&&(l.curRoute=t.curRoute),e.selectTab&&(l.selectTab=t.selectTab),e.routes&&(l.routes=t.routes),c.$set(l)},i(e){o||(A(s.$$.fragment,e),A(r.$$.fragment,e),A(c.$$.fragment,e),o=!0)},o(e){E(s.$$.fragment,e),E(r.$$.fragment,e),E(c.$$.fragment,e),o=!1},d(e){B(s,e),e&&a(t),B(r,e),e&&a(n),B(c,e)}}}function K(e){var t,n,o,s,r,c,l=1==e.pgi&&Y(e),p=e.$session.user&&Z(e),d=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/profile"}}),h=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/about"}});return{c(){t=m("header"),n=m("ul"),l&&l.c(),o=f(),p&&p.c(),s=f(),d.$$.fragment.c(),r=f(),h.$$.fragment.c(),b(t,"id","navigation")},m(e,a){i(e,t,a),u(t,n),l&&l.m(n,null),u(n,o),p&&p.m(n,null),u(n,s),J(d,n,null),u(n,r),J(h,n,null),c=!0},p(e,t){1==t.pgi?l?(l.p(e,t),A(l,1)):((l=Y(t)).c(),A(l,1),l.m(n,o)):l&&(I(),E(l,1,1,()=>{l=null}),F()),t.$session.user?p?(p.p(e,t),A(p,1)):((p=Z(t)).c(),A(p,1),p.m(n,s)):p&&(I(),E(p,1,1,()=>{p=null}),F());var r={};e.curRoute&&(r.curRoute=t.curRoute),e.selectTab&&(r.selectTab=t.selectTab),e.routes&&(r.routes=t.routes),d.$set(r);var c={};e.curRoute&&(c.curRoute=t.curRoute),e.selectTab&&(c.selectTab=t.selectTab),e.routes&&(c.routes=t.routes),h.$set(c)},i(e){c||(A(l),A(p),A(d.$$.fragment,e),A(h.$$.fragment,e),c=!0)},o(e){E(l),E(p),E(d.$$.fragment,e),E(h.$$.fragment,e),c=!1},d(e){e&&a(t),l&&l.d(),p&&p.d(),B(d),B(h)}}}function Q(e,t,n){let o,{routes:s,curRoute:r,selectTab:c,pgi:u,session:i}=t;return l(e,i,e=>{n("$session",o=e)}),e.$set=(e=>{"routes"in e&&n("routes",s=e.routes),"curRoute"in e&&n("curRoute",r=e.curRoute),"selectTab"in e&&n("selectTab",c=e.selectTab),"pgi"in e&&n("pgi",u=e.pgi),"session"in e&&n("session",i=e.session)}),{routes:s,curRoute:r,selectTab:c,pgi:u,session:i,$session:o}}class V extends M{constructor(e){super(),H(this,e,Q,K,c,["routes","curRoute","selectTab","pgi","session"])}}function X(t){var n,o,s;return{c(){n=m("hr"),o=f(),(s=m("footer")).innerHTML='<div class="left-column"><h3>PubGate-Philip</h3></div>',b(n,"class","separator"),b(s,"class","content")},m(e,t){i(e,n,t),i(e,o,t),i(e,s,t)},p:e,i:e,o:e,d(e){e&&(a(n),a(o),a(s))}}}class ee extends M{constructor(e){super(),H(this,e,null,X,c,[])}}const te={Accept:"application/activity+json"};let ne,oe;const se=base_url.match(/^([^:]+):\/\/([^\/]+)/);se?(ne=se[1],oe=se[2]):console.log("matchUrl is null",base_url);const re=(e,t={headers:te},n=(e=>e))=>(console.log("fetching",e,t),fetch(e,t).then(e=>e.json()).catch(t=>console.log("request failed:",e,t)).then(n)),ce=(e,t={})=>{let n={headers:te};return fetch(e,Object.assign(n,t)).then(e=>e.json()).catch(t=>re(e,t))},le=async(e,t={})=>re(e,Object.assign({headers:te},t)),ue=e=>{const t={method:"POST",body:JSON.stringify({url:e})};return console.log("proxy fetch",e,t),re(base_url+"/proxy",t)},ie=function(e,t={},n=!1){console.log("fetching collection",e);let o=te;return t.user&&n&&(o.Authorization="Bearer "+t.token),re(e,{headers:o})},ae=async e=>{const t=await ue(e);return console.log("outbox",t),t.error?t:"string"==typeof t.first?await ue(t.first):t.first},pe=(e,t=oe,n=!0)=>{return console.log("getUserId",t,oe,ne),`${t===oe?ne:"https"}://${t}/`+(n?`@${e}`:`.well-known/webfinger?resource=acc:${e}@${t}`)},me=async(e,t)=>{const n=await re(pe(e,t));if(n&&!n.error)return n;const o=await re(pe(e,t,!1));if(!o||o.error)return o;o.aliases[1]||o.links[0].href;return re(url)},de=async(e,t)=>{const n=te;n.Authorization="Bearer "+e.token;const o={method:"POST",body:t,headers:n};return re(e.user.outbox,o)},fe=async e=>{try{const t=await ce(e),{type:n}=t;return"Note"!==n?{error:`Wrong type: ${n}`}:t}catch(e){return{error:e.message}}},he=(e,t)=>{try{const n={method:"POST",body:t,headers:{Authorization:"Bearer "+e.token}};return re(e.user.outbox,n)}catch(e){return console.log("publish failed",e),{error:e}}};function ge(e,t,n){const o=Object.create(e);return o.attachment=t[n],o}function $e(e){var t,n;return{c(){t=m("a"),n=d("Original post"),b(t,"class","original svelte-66q9dc"),b(t,"href",e.post)},m(e,o){i(e,t,o),u(t,n)},p(e,n){e.post&&b(t,"href",n.post)},d(e){e&&a(t)}}}function be(e){var t,n,o,s=e.post.content,r=e.post.attachment&&ve(e);return{c(){t=m("p"),n=f(),r&&r.c(),o=h()},m(e,c){i(e,t,c),t.innerHTML=s,i(e,n,c),r&&r.m(e,c),i(e,o,c)},p(e,n){e.post&&s!==(s=n.post.content)&&(t.innerHTML=s),n.post.attachment?r?r.p(e,n):((r=ve(n)).c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},d(e){e&&(a(t),a(n)),r&&r.d(e),e&&a(o)}}}function ve(e){for(var t,n=e.post.attachment,o=[],s=0;s<n.length;s+=1)o[s]=we(ge(e,n,s));return{c(){for(var e=0;e<o.length;e+=1)o[e].c();t=h()},m(e,n){for(var s=0;s<o.length;s+=1)o[s].m(e,n);i(e,t,n)},p(e,s){if(e.post){n=s.post.attachment;for(var r=0;r<n.length;r+=1){const c=ge(s,n,r);o[r]?o[r].p(e,c):(o[r]=we(c),o[r].c(),o[r].m(t.parentNode,t))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(e){p(o,e),e&&a(t)}}}function ke(e){var t,n;return{c(){b(t=m("img"),"src",n=e.attachment.url),b(t,"alt","image")},m(e,n){i(e,t,n)},p(e,o){e.post&&n!==(n=o.attachment.url)&&b(t,"src",n)},d(e){e&&a(t)}}}function we(e){var t,n="Document"===e.attachment.type&&e.attachment.mediaType.startsWith("image")&&ke(e);return{c(){n&&n.c(),t=h()},m(e,o){n&&n.m(e,o),i(e,t,o)},p(e,o){"Document"===o.attachment.type&&o.attachment.mediaType.startsWith("image")?n?n.p(e,o):((n=ke(o)).c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&a(t)}}}function ye(t){var n;function o(e){return e.post.id?be:$e}var s=o(t),r=s(t);return{c(){r.c(),n=h()},m(e,t){r.m(e,t),i(e,n,t)},p(e,t){s===(s=o(t))&&r?r.p(e,t):(r.d(1),(r=s(t))&&(r.c(),r.m(n.parentNode,n)))},i:e,o:e,d(e){r.d(e),e&&a(n)}}}function Re(e,t,n){let{post:o}=t;return e.$set=(e=>{"post"in e&&n("post",o=e.post)}),{post:o}}class xe extends M{constructor(e){super(),H(this,e,Re,ye,c,["post"])}}function _e(t){var n,o,s,r,c,l,p,h,g,$,k,w,y=t.post.type,R=t.post.published.replace("T"," ").replace("Z"," ");return{c(){n=m("div"),o=m("a"),s=d(y),c=d("\n  by\n  "),l=m("a"),p=d(t.userName),h=f(),(g=m("span")).textContent="Â·",$=f(),k=m("span"),w=d(R),b(o,"href",r=t.post.id),b(l,"href",t.userId),b(g,"class","metadata-seperator"),b(n,"class","metadata")},m(e,t){i(e,n,t),u(n,o),u(o,s),u(n,c),u(n,l),u(l,p),u(n,h),u(n,g),u(n,$),u(n,k),u(k,w)},p(e,t){e.post&&y!==(y=t.post.type)&&v(s,y),e.post&&r!==(r=t.post.id)&&b(o,"href",r),e.userId&&b(l,"href",t.userId),e.post&&R!==(R=t.post.published.replace("T"," ").replace("Z"," "))&&v(w,R)},i:e,o:e,d(e){e&&a(n)}}}function Te(e,t,n){let{post:o}=t,s=o.hasOwnProperty("actor")?o.actor:o.attributedTo;"string"!=typeof s&&n("userId",s=s[0]);const r=s.replace(/^.+\@([^\/@]+)$/,"$1");return e.$set=(e=>{"post"in e&&n("post",o=e.post)}),{post:o,userId:s,userName:r}}class je extends M{constructor(e){super(),H(this,e,Te,_e,c,["post"])}}function Pe(e,t,n){const o=Object.create(e);return o.tag=t[n],o}function Se(e){for(var t,n=e.tags,o=[],s=0;s<n.length;s+=1)o[s]=Ne(Pe(e,n,s));return{c(){t=m("div");for(var e=0;e<o.length;e+=1)o[e].c();b(t,"class","tags")},m(e,n){i(e,t,n);for(var s=0;s<o.length;s+=1)o[s].m(t,null)},p(e,s){if(e.tags){n=s.tags;for(var r=0;r<n.length;r+=1){const c=Pe(s,n,r);o[r]?o[r].p(e,c):(o[r]=Ne(c),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(e){e&&a(t),p(o,e)}}}function Ce(e){var t,n,o,s=e.tag.name;return{c(){t=m("a"),n=d(s),b(t,"class","tag"),b(t,"href",o=e.tag.href)},m(e,o){i(e,t,o),u(t,n)},p(e,r){e.tags&&s!==(s=r.tag.name)&&v(n,s),e.tags&&o!==(o=r.tag.href)&&b(t,"href",o)},d(e){e&&a(t)}}}function Ne(e){var t,n="Hashtag"==e.tag.type&&Ce(e);return{c(){n&&n.c(),t=h()},m(e,o){n&&n.m(e,o),i(e,t,o)},p(e,o){"Hashtag"==o.tag.type?n?n.p(e,o):((n=Ce(o)).c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&a(t)}}}function Oe(t){var n,o=t.tags&&Se(t);return{c(){o&&o.c(),n=h()},m(e,t){o&&o.m(e,t),i(e,n,t)},p(e,t){t.tags?o?o.p(e,t):((o=Se(t)).c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i:e,o:e,d(e){o&&o.d(e),e&&a(n)}}}function Ue(e,t,n){let{tags:o}=t;return e.$set=(e=>{"tags"in e&&n("tags",o=e.tags)}),{tags:o}}class Le extends M{constructor(e){super(),H(this,e,Ue,Oe,c,["tags"])}}function Ie(t){return{c:e,m:e,p:e,d:e}}function Fe(t){var n;return{c(){b(n=m("img"),"src",t.url),b(n,"alt","avatar"),b(n,"class","svelte-jvacvf")},m(e,t){i(e,n,t)},p:e,d(e){e&&a(n)}}}function Ae(t){return{c:e,m:e,p:e,d:e}}function Ee(n){var o,s,r,c,l;let p={ctx:n,current:null,token:null,pending:Ae,then:Fe,catch:Ie,value:"url",error:"null"};return D(l=n.avatar,p),{c(){o=m("div"),s=m("a"),r=d(n.name),c=f(),p.block.c(),b(s,"href",n.id),b(o,"class","svelte-jvacvf")},m(e,t){i(e,o,t),u(o,s),u(s,r),u(o,c),p.block.m(o,p.anchor=null),p.mount=(()=>o),p.anchor=null},p(e,o){n=o,e.id&&b(s,"href",n.id),p.ctx=n,l!==(l=n.avatar)&&D(l,p)||p.block.p(e,t(t({},n),p.resolved))},i:e,o:e,d(e){e&&a(o),p.block.d(),p.token=null,p=null}}}const De="favicon.png";function Je(e,t,n){let{id:o}=t;const s=(e=>{const t=e.match(/@([^\/]+)$/);return t?t[1]:e})(o),r=(async e=>De)();return e.$set=(e=>{"id"in e&&n("id",o=e.id)}),{id:o,name:s,avatar:r}}class Be extends M{constructor(e){super(),H(this,e,Je,Ee,c,["id"])}}function qe(e,t,n){const o=Object.create(e);return o.item=t[n],o}function He(e){for(var t,n,o=e.items,s=[],r=0;r<o.length;r+=1)s[r]=Me(qe(e,o,r));const c=e=>E(s[e],1,1,()=>{s[e]=null});return{c(){t=m("div");for(var e=0;e<s.length;e+=1)s[e].c();b(t,"class","reaction-tooltip svelte-h6hymt")},m(e,o){i(e,t,o);for(var r=0;r<s.length;r+=1)s[r].m(t,null);n=!0},p(e,n){if(e.items){o=n.items;for(var r=0;r<o.length;r+=1){const c=qe(n,o,r);s[r]?(s[r].p(e,c),A(s[r],1)):(s[r]=Me(c),s[r].c(),A(s[r],1),s[r].m(t,null))}for(I(),r=o.length;r<s.length;r+=1)c(r);F()}},i(e){if(!n){for(var t=0;t<o.length;t+=1)A(s[t]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)E(s[e]);n=!1},d(e){e&&a(t),p(s,e)}}}function Me(e){var t,n=new Be({props:{id:e.item.actor}});return{c(){n.$$.fragment.c()},m(e,o){J(n,e,o),t=!0},p(e,t){var o={};e.items&&(o.id=t.item.actor),n.$set(o)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){E(n.$$.fragment,e),t=!1},d(e){B(n,e)}}}function We(e){var t,n,o,s,r=e.items.length&&He(e);return{c(){t=m("div"),n=d(e.label),o=f(),r&&r.c(),b(t,"class","overlay svelte-h6hymt")},m(e,c){i(e,t,c),u(t,n),u(t,o),r&&r.m(t,null),s=!0},p(e,o){s&&!e.label||v(n,o.label),o.items.length?r?(r.p(e,o),A(r,1)):((r=He(o)).c(),A(r,1),r.m(t,null)):r&&(I(),E(r,1,1,()=>{r=null}),F())},i(e){s||(A(r),s=!0)},o(e){E(r),s=!1},d(e){e&&a(t),r&&r.d()}}}function ze(e,t,n){let{label:o,data:s}=t,r=[];return s&&n("items",r=s.first?s.first.orderedItems:s.orderedItems),e.$set=(e=>{"label"in e&&n("label",o=e.label),"data"in e&&n("data",s=e.data)}),{label:o,data:s,items:r}}class Ge extends M{constructor(e){super(),H(this,e,ze,We,c,["label","data"])}}const Ye=e=>({name:e,href:"",type:"Hashtag"}),Ze=(e,t)=>({name:e,href:t,type:"Mention"}),Ke=(e,t)=>({type:"Create",object:{type:"Note",attachment:[],tag:t,content:e}});function Qe(t){var n,o,r,c,l,p,h,$,k,w,y;return{c(){n=m("form"),o=m("fieldset"),r=m("textarea"),c=f(),l=m("button"),p=d("Publish"),$=f(),k=m("p"),w=d(t.error),b(r,"class","form-control svelte-1fvj4fs"),b(r,"placeholder","Write your text here"),b(o,"class","form-group"),b(l,"class","btn btn-sm pull-xs-right btn-info"),l.disabled=h=!t.content||t.inProgress,b(k,"class","text-danger"),y=[g(r,"input",t.textarea_input_handler),g(n,"submit",t.handleSubmit)]},m(e,s){i(e,n,s),u(n,o),u(o,r),r.value=t.content,u(n,c),u(n,l),u(l,p),i(e,$,s),i(e,k,s),u(k,w)},p(e,t){e.content&&(r.value=t.content),(e.content||e.inProgress)&&h!==(h=!t.content||t.inProgress)&&(l.disabled=h),e.error&&v(w,t.error)},i:e,o:e,d(e){e&&(a(n),a($),a(k)),s(y)}}}const Ve=/(^|\W)(#[^#\s]+)/gi,Xe=/(^|\W)@([^@\s]+)(@([^@\s]+))?/gi;function et(e,t,n){let o,{reply:s=null,session:r,curRoute:c}=t;l(e,r,e=>{n("$session",o=e)});let u=!1,i="",a="";return e.$set=(e=>{"reply"in e&&n("reply",s=e.reply),"session"in e&&n("session",r=e.session),"curRoute"in e&&n("curRoute",c=e.curRoute)}),{reply:s,session:r,curRoute:c,inProgress:u,content:i,error:a,handleSubmit:async e=>{e.preventDefault(),n("inProgress",u=!0);const t=(e=>e.match(Ve)||[])(i).map(e=>e.trim()).map(Ye);n("content",i=(e=>e.replace(Ve,'$1<a href="" rel="tag">$2</a>'))((e=>e.replace(/( https?:\/\/([^\s]+))/gi,'<a href="$1">$2</a>'))(i)));const r=(e=>[...e.matchAll(Xe)]||[])(i).map(e=>{const t=e[0],o=e[2],s=e[4],r=pe(o,s),c=`${e[1]}<span class='h-card'><a href="${r}"' class='u-url mention'>@<span>${o}</span></a></span>`;return n("content",i=i.replace(t,c)),Ze(o,r)});let c=Ke(i,t.concat(r));c.cc=r.map(e=>e.href),s&&(c.object.inReplyTo=s.id,s.attributedTo!==o.user.url&&(c.cc=c.cc.concat(s.attributedTo)));const l=JSON.stringify(c),p=await outboxPost(o,l);p.error?n("error",a=p.error):"success"!==p.Created?n("error",a="Failed to create post: "+JSON.stringify(p)):n("content",i=""),n("inProgress",u=!1)},textarea_input_handler:function(){i=this.value,n("content",i)}}}class tt extends M{constructor(e){super(),H(this,e,et,Qe,c,["reply","session","curRoute"])}}function nt(e){var n,o,s,r,c,l,p,d,h,g,$,v,k,w=new je({props:{post:e.post}}),y=new Le({props:{tags:e.tags}}),R=new xe({props:{post:e.post}});let x={ctx:e,current:null,token:null,pending:ct,then:rt,catch:st,value:"likes",error:"null",blocks:[,,,]};D(l=e.likes,x);let _={ctx:e,current:null,token:null,pending:it,then:ut,catch:lt,value:"comments",error:"null"};D(d=e.comments,_);let T={ctx:e,current:null,token:null,pending:mt,then:pt,catch:at,value:"announces",error:"null",blocks:[,,,]};D(g=e.announces,T);var j=e.$session.user&&dt(e),P=e.showComments&&$t(e);return{c(){w.$$.fragment.c(),n=f(),y.$$.fragment.c(),o=f(),R.$$.fragment.c(),s=f(),r=m("div"),c=m("div"),x.block.c(),p=f(),_.block.c(),h=f(),T.block.c(),$=f(),j&&j.c(),v=f(),P&&P.c(),b(c,"class","rs svelte-vekltv")},m(e,t){J(w,e,t),i(e,n,t),J(y,e,t),i(e,o,t),J(R,e,t),i(e,s,t),i(e,r,t),u(r,c),x.block.m(c,x.anchor=null),x.mount=(()=>c),x.anchor=p,u(c,p),_.block.m(c,_.anchor=null),_.mount=(()=>c),_.anchor=h,u(c,h),T.block.m(c,T.anchor=null),T.mount=(()=>c),T.anchor=null,u(r,$),j&&j.m(r,null),u(r,v),P&&P.m(r,null),k=!0},p(n,o){e=o;var s={};n.post&&(s.post=e.post),w.$set(s);var c={};n.tags&&(c.tags=e.tags),y.$set(c);var u={};n.post&&(u.post=e.post),R.$set(u),x.ctx=e,l!==(l=e.likes)&&D(l,x)||x.block.p(n,t(t({},e),x.resolved)),_.ctx=e,d!==(d=e.comments)&&D(d,_)||_.block.p(n,t(t({},e),_.resolved)),T.ctx=e,g!==(g=e.announces)&&D(g,T)||T.block.p(n,t(t({},e),T.resolved)),e.$session.user?j?(j.p(n,e),A(j,1)):((j=dt(e)).c(),A(j,1),j.m(r,v)):j&&(I(),E(j,1,1,()=>{j=null}),F()),e.showComments?P?(P.p(n,e),A(P,1)):((P=$t(e)).c(),A(P,1),P.m(r,null)):P&&(I(),E(P,1,1,()=>{P=null}),F())},i(e){k||(A(w.$$.fragment,e),A(y.$$.fragment,e),A(R.$$.fragment,e),A(x.block),A(T.block),A(j),A(P),k=!0)},o(e){E(w.$$.fragment,e),E(y.$$.fragment,e),E(R.$$.fragment,e);for(let e=0;e<3;e+=1){E(x.blocks[e])}for(let e=0;e<3;e+=1){E(T.blocks[e])}E(j),E(P),k=!1},d(e){B(w,e),e&&a(n),B(y,e),e&&a(o),B(R,e),e&&(a(s),a(r)),x.block.d(),x.token=null,x=null,_.block.d(),_.token=null,_=null,T.block.d(),T.token=null,T=null,j&&j.d(),P&&P.d()}}}function ot(t){var n,o;return{c(){n=m("a"),o=d(t.post),b(n,"href",t.post)},m(e,t){i(e,n,t),u(n,o)},p(e,t){e.post&&(v(o,t.post),b(n,"href",t.post))},i:e,o:e,d(e){e&&a(n)}}}function st(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function rt(e){var t,n,o=new Ge({props:{label:`${e.likes.totalItems} likes`,data:e.likes.first}});return{c(){t=m("span"),o.$$.fragment.c(),b(t,"class","rs_left svelte-vekltv")},m(e,s){i(e,t,s),J(o,t,null),n=!0},p(e,t){var n={};e.likes&&(n.label=`${t.likes.totalItems} likes`),e.likes&&(n.data=t.likes.first),o.$set(n)},i(e){n||(A(o.$$.fragment,e),n=!0)},o(e){E(o.$$.fragment,e),n=!1},d(e){e&&a(t),B(o)}}}function ct(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function lt(t){return{c:e,m:e,p:e,d:e}}function ut(t){var n,o,s,r,c=t.comments.totalItems;return{c(){n=m("span"),o=d(c),s=d(" comments"),b(n,"class","rs_right svelte-vekltv"),r=g(n,"click",t.toggleShowComments)},m(e,t){i(e,n,t),u(n,o),u(n,s)},p:e,d(e){e&&a(n),r()}}}function it(t){return{c:e,m:e,p:e,d:e}}function at(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function pt(e){var t,n,o=new Ge({props:{label:`${e.announces.totalItems} announces`,data:e.announces.first}});return{c(){t=m("span"),o.$$.fragment.c(),b(t,"class","rs_right svelte-vekltv")},m(e,s){i(e,t,s),J(o,t,null),n=!0},p(e,t){var n={};e.announces&&(n.label=`${t.announces.totalItems} announces`),e.announces&&(n.data=t.announces.first),o.$set(n)},i(e){n||(A(o.$$.fragment,e),n=!0)},o(e){E(o.$$.fragment,e),n=!1},d(e){e&&a(t),B(o)}}}function mt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function dt(e){var t,n,o,r,c,l,p,$,v,k,w,y,R=e.liked&&ft(),x=e.announced&&ht(),_=e.showPublish&&gt(e);return{c(){t=m("div"),n=m("button"),o=d("Like\n          "),R&&R.c(),r=f(),(c=m("button")).textContent="Add comment",l=f(),p=m("button"),$=d("Announce\n          "),x&&x.c(),v=f(),_&&_.c(),k=h(),b(n,"class","btn btn-dark ra_item svelte-vekltv"),b(c,"class","btn btn-dark ra_item svelte-vekltv"),b(p,"class","btn btn-dark ra_item svelte-vekltv"),b(t,"class","ra svelte-vekltv"),y=[g(n,"click",e.doLike),g(c,"click",e.togglePublish),g(p,"click",e.doAnnounce)]},m(e,s){i(e,t,s),u(t,n),u(n,o),R&&R.m(n,null),u(t,r),u(t,c),u(t,l),u(t,p),u(p,$),x&&x.m(p,null),i(e,v,s),_&&_.m(e,s),i(e,k,s),w=!0},p(e,t){t.liked?R||((R=ft()).c(),R.m(n,null)):R&&(R.d(1),R=null),t.announced?x||((x=ht()).c(),x.m(p,null)):x&&(x.d(1),x=null),t.showPublish?_?(_.p(e,t),A(_,1)):((_=gt(t)).c(),A(_,1),_.m(k.parentNode,k)):_&&(I(),E(_,1,1,()=>{_=null}),F())},i(e){w||(A(_),w=!0)},o(e){E(_),w=!1},d(e){e&&a(t),R&&R.d(),x&&x.d(),e&&a(v),_&&_.d(e),e&&a(k),s(y)}}}function ft(e){var t;return{c(){t=d("d")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function ht(e){var t;return{c(){t=d("d")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function gt(e){var t,n=new tt({props:{reply:e.post,session:e.session}});return{c(){n.$$.fragment.c()},m(e,o){J(n,e,o),t=!0},p(e,t){var o={};e.post&&(o.reply=t.post),e.session&&(o.session=t.session),n.$set(o)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){E(n.$$.fragment,e),t=!1},d(e){B(n,e)}}}function $t(e){var n,o,s;let r={ctx:e,current:null,token:null,pending:wt,then:vt,catch:bt,value:"collection",error:"null",blocks:[,,,]};return D(o=e.comments,r),{c(){n=h(),r.block.c()},m(e,t){i(e,n,t),r.block.m(e,r.anchor=t),r.mount=(()=>n.parentNode),r.anchor=n,s=!0},p(n,s){e=s,r.ctx=e,o!==(o=e.comments)&&D(o,r)||r.block.p(n,t(t({},e),r.resolved))},i(e){s||(A(r.block),s=!0)},o(e){for(let e=0;e<3;e+=1){E(r.blocks[e])}s=!1},d(e){e&&a(n),r.block.d(e),r.token=null,r=null}}}function bt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function vt(e){var t,n,o=e.collection.totalItems&&kt(e);return{c(){o&&o.c(),t=h()},m(e,s){o&&o.m(e,s),i(e,t,s),n=!0},p(e,n){n.collection.totalItems?o?(o.p(e,n),A(o,1)):((o=kt(n)).c(),A(o,1),o.m(t.parentNode,t)):o&&(I(),E(o,1,1,()=>{o=null}),F())},i(e){n||(A(o),n=!0)},o(e){E(o),n=!1},d(e){o&&o.d(e),e&&a(t)}}}function kt(e){var t,n,o=new Wt({props:{collection:e.collection,session:e.session,content:Rt}});return{c(){t=m("div"),o.$$.fragment.c(),b(t,"class","comments svelte-vekltv")},m(e,s){i(e,t,s),J(o,t,null),n=!0},p(e,t){var n={};e.comments&&(n.collection=t.collection),e.session&&(n.session=t.session),e.content&&(n.content=Rt),o.$set(n)},i(e){n||(A(o.$$.fragment,e),n=!0)},o(e){E(o.$$.fragment,e),n=!1},d(e){e&&a(t),B(o)}}}function wt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function yt(e){var t,n,o,s,r=[ot,nt],c=[];function l(e){return e.isID?0:1}return t=l(e),n=c[t]=r[t](e),{c(){n.c(),o=h()},m(e,n){c[t].m(e,n),i(e,o,n),s=!0},p(e,s){var u=t;(t=l(s))===u?c[t].p(e,s):(I(),E(c[u],1,1,()=>{c[u]=null}),F(),(n=c[t])||(n=c[t]=r[t](s)).c(),A(n,1),n.m(o.parentNode,o))},i(e){s||(A(n),s=!0)},o(e){E(n),s=!1},d(e){c[t].d(e),e&&a(o)}}}let Rt="replies";function xt(e,t,n){let o,{post:s,session:r,showComments:c}=t;l(e,r,e=>{n("$session",o=e)});let u=pubgate_instance,i=!1,a="string"==typeof s,p=s.tag;const m=async e=>{if(!e)return"n/a";const t="string"!=typeof e||u?e:await re(e);return"string"==typeof t.first&&console.log("first is string",t),t};let d,f,h=m(s.likes),g=m(s.replies),$=m(s.shares);o.user&&s.reactions&&(s.reactions.Like?s.reactions.Like[o.user.name]&&n("liked",d=!0):s.reactions.Announce&&s.reactions.Announce[o.user.name]&&n("announced",f=!0));o.token;return e.$set=(e=>{"post"in e&&n("post",s=e.post),"session"in e&&n("session",r=e.session),"showComments"in e&&n("showComments",c=e.showComments)}),{post:s,session:r,showComments:c,showPublish:i,isID:a,tags:p,togglePublish:e=>{e.preventDefault(),n("showPublish",i=!i)},toggleShowComments:e=>{e.preventDefault(),n("showComments",c=!c)},likes:h,comments:g,announces:$,liked:d,announced:f,doLike:async e=>{if(e.preventDefault(),d)return;const t=s.id,r=[s.attributedTo],c=JSON.stringify({type:"Like",object:t,cc:r});await he(o,c);n("liked",d=!0)},doAnnounce:async e=>{if(e.preventDefault(),f)return;const t=s.id,r=[s.attributedTo],c=JSON.stringify({type:"Announce",object:t,cc:r});await he(o,c);n("announced",f=!0)},$session:o}}class _t extends M{constructor(e){super(),H(this,e,xt,yt,c,["post","session","showComments"])}}function Tt(e){var t,n,o,s,r,c,l=[Ct,St,Pt],u=[];function p(e){return e.isReaction?0:e.isReply?1:2}return o=p(e),s=u[o]=l[o](e),{c(){(t=m("h2")).textContent=".",n=f(),s.c(),r=h(),b(t,"id","")},m(e,s){i(e,t,s),i(e,n,s),u[o].m(e,s),i(e,r,s),c=!0},p(e,t){var n=o;(o=p(t))===n?u[o].p(e,t):(I(),E(u[n],1,1,()=>{u[n]=null}),F(),(s=u[o])||(s=u[o]=l[o](t)).c(),A(s,1),s.m(r.parentNode,r))},i(e){c||(A(s),c=!0)},o(e){E(s),c=!1},d(e){e&&(a(t),a(n)),u[o].d(e),e&&a(r)}}}function jt(e){var t,n,o=new _t({props:{post:e.post.object,session:e.session,showComments:Ot}});return{c(){t=m("div"),o.$$.fragment.c(),b(t,"class","reaction svelte-fh8bnq")},m(e,s){i(e,t,s),J(o,t,null),n=!0},p(e,t){var n={};e.post&&(n.post=t.post.object),e.session&&(n.session=t.session),e.showComments&&(n.showComments=Ot),o.$set(n)},i(e){n||(A(o.$$.fragment,e),n=!0)},o(e){E(o.$$.fragment,e),n=!1},d(e){e&&a(t),B(o)}}}function Pt(e){var t,n=new _t({props:{post:e.post.object,session:e.session,showComments:Ot}});return{c(){n.$$.fragment.c()},m(e,o){J(n,e,o),t=!0},p(e,t){var o={};e.post&&(o.post=t.post.object),e.session&&(o.session=t.session),e.showComments&&(o.showComments=Ot),n.$set(o)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){E(n.$$.fragment,e),t=!1},d(e){B(n,e)}}}function St(e){var t,n,o,s=new _t({props:{post:e.postObject,session:e.session,showComments:Ut}}),r=new _t({props:{post:e.postObject.inReplyTo,session:e.session,showComments:Ut}});return{c(){s.$$.fragment.c(),t=f(),n=m("div"),r.$$.fragment.c(),b(n,"class","reaction svelte-fh8bnq")},m(e,c){J(s,e,c),i(e,t,c),i(e,n,c),J(r,n,null),o=!0},p(e,t){var n={};e.postObject&&(n.post=t.postObject),e.session&&(n.session=t.session),e.notShowComments&&(n.showComments=Ut),s.$set(n);var o={};e.postObject&&(o.post=t.postObject.inReplyTo),e.session&&(o.session=t.session),e.notShowComments&&(o.showComments=Ut),r.$set(o)},i(e){o||(A(s.$$.fragment,e),A(r.$$.fragment,e),o=!0)},o(e){E(s.$$.fragment,e),E(r.$$.fragment,e),o=!1},d(e){B(s,e),e&&(a(t),a(n)),B(r)}}}function Ct(e){var t,n,o,s=new je({props:{post:e.post}}),r=new _t({props:{post:e.postObject,session:e.session,showComments:Ut}});return{c(){s.$$.fragment.c(),t=f(),n=m("div"),r.$$.fragment.c(),b(n,"class","reaction svelte-fh8bnq")},m(e,c){J(s,e,c),i(e,t,c),i(e,n,c),J(r,n,null),o=!0},p(e,t){var n={};e.post&&(n.post=t.post),s.$set(n);var o={};e.postObject&&(o.post=t.postObject),e.session&&(o.session=t.session),e.notShowComments&&(o.showComments=Ut),r.$set(o)},i(e){o||(A(s.$$.fragment,e),A(r.$$.fragment,e),o=!0)},o(e){E(s.$$.fragment,e),E(r.$$.fragment,e),o=!1},d(e){B(s,e),e&&(a(t),a(n)),B(r)}}}function Nt(e){var t,n,o,s,r=[jt,Tt],c=[];function l(e){return"replies"==e.content?0:1}return n=l(e),o=c[n]=r[n](e),{c(){t=m("li"),o.c(),b(t,"class","post")},m(e,o){i(e,t,o),c[n].m(t,null),s=!0},p(e,s){var u=n;(n=l(s))===u?c[n].p(e,s):(I(),E(c[u],1,1,()=>{c[u]=null}),F(),(o=c[n])||(o=c[n]=r[n](s)).c(),A(o,1),o.m(t,null))},i(e){s||(A(o),s=!0)},o(e){E(o),s=!1},d(e){e&&a(t),c[n].d()}}}let Ot=!0,Ut=!1;function Lt(e,t,n){let o,s,r,{post:c,session:l,content:u}=t,i=pubgate_instance;return"replies"==u?(c.object.type="Reply",n("post",c)):(["Announce","Like"].includes(c.type)||c.object.inReplyTo)&&(n("postObject",o=i?c.object:function(e){if("string"==typeof e){let t;return t=ce(e),e=>e.object}return e}(c.object)),["Announce","Like"].includes(c.type)?n("isReaction",r=!0):o.inReplyTo&&(n("isReply",s=!0),o.type="Reply",n("postObject",o),"string"!=typeof o.inReplyTo&&(o.inReplyTo.type="To "+o.inReplyTo.type,n("postObject",o)))),e.$set=(e=>{"post"in e&&n("post",c=e.post),"session"in e&&n("session",l=e.session),"content"in e&&n("content",u=e.content)}),{post:c,session:l,content:u,postObject:o,isReply:s,isReaction:r}}class It extends M{constructor(e){super(),H(this,e,Lt,Nt,c,["post","session","content"])}}function Ft(e,t,n){const o=Object.create(e);return o.post=t[n],o}function At(e){var t,n=new It({props:{post:e.post,session:e.session,content:e.content}});return{c(){n.$$.fragment.c()},m(e,o){J(n,e,o),t=!0},p(e,t){var o={};e.posts&&(o.post=t.post),e.session&&(o.session=t.session),e.content&&(o.content=t.content),n.$set(o)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){E(n.$$.fragment,e),t=!1},d(e){B(n,e)}}}function Et(e){var t,n,o,s,r=e.homeUrl&&Dt(e),c=e.prevUrl&&Jt(e),l=e.page&&Bt(e),p=e.nextUrl&&qt(e);return{c(){t=m("div"),r&&r.c(),n=f(),c&&c.c(),o=f(),l&&l.c(),s=f(),p&&p.c(),b(t,"class","navigation")},m(e,a){i(e,t,a),r&&r.m(t,null),u(t,n),c&&c.m(t,null),u(t,o),l&&l.m(t,null),u(t,s),p&&p.m(t,null)},p(e,u){u.homeUrl?r||((r=Dt(u)).c(),r.m(t,n)):r&&(r.d(1),r=null),u.prevUrl?c||((c=Jt(u)).c(),c.m(t,o)):c&&(c.d(1),c=null),u.page?l?l.p(e,u):((l=Bt(u)).c(),l.m(t,s)):l&&(l.d(1),l=null),u.nextUrl?p||((p=qt(u)).c(),p.m(t,null)):p&&(p.d(1),p=null)},d(e){e&&a(t),r&&r.d(),c&&c.d(),l&&l.d(),p&&p.d()}}}function Dt(e){var t,n;return{c(){(t=m("span")).textContent="First",n=g(t,"click",e.click_handler)},m(e,n){i(e,t,n)},d(e){e&&a(t),n()}}}function Jt(e){var t,n;return{c(){(t=m("span")).textContent="Previous",n=g(t,"click",e.click_handler_1)},m(e,n){i(e,t,n)},d(e){e&&a(t),n()}}}function Bt(e){var t,n;return{c(){t=m("b"),n=d(e.page)},m(e,o){i(e,t,o),u(t,n)},p(e,t){e.page&&v(n,t.page)},d(e){e&&a(t)}}}function qt(e){var t,n;return{c(){(t=m("span")).textContent="Next",n=g(t,"click",e.click_handler_2)},m(e,n){i(e,t,n)},d(e){e&&a(t),n()}}}function Ht(e){for(var t,n,o,s,r=e.posts,c=[],l=0;l<r.length;l+=1)c[l]=At(Ft(e,r,l));const u=e=>E(c[e],1,1,()=>{c[e]=null});var d=(e.homeUrl||e.prevUrl||e.nextUrl)&&Et(e);return{c(){t=m("ul");for(var e=0;e<c.length;e+=1)c[e].c();n=f(),d&&d.c(),o=h(),b(t,"class","post-list")},m(e,r){i(e,t,r);for(var l=0;l<c.length;l+=1)c[l].m(t,null);i(e,n,r),d&&d.m(e,r),i(e,o,r),s=!0},p(e,n){if(e.posts||e.session||e.content){r=n.posts;for(var s=0;s<r.length;s+=1){const o=Ft(n,r,s);c[s]?(c[s].p(e,o),A(c[s],1)):(c[s]=At(o),c[s].c(),A(c[s],1),c[s].m(t,null))}for(I(),s=r.length;s<c.length;s+=1)u(s);F()}n.homeUrl||n.prevUrl||n.nextUrl?d?d.p(e,n):((d=Et(n)).c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null)},i(e){if(!s){for(var t=0;t<r.length;t+=1)A(c[t]);s=!0}},o(e){c=c.filter(Boolean);for(let e=0;e<c.length;e+=1)E(c[e]);s=!1},d(e){e&&a(t),p(c,e),e&&a(n),d&&d.d(e),e&&a(o)}}}function Mt(e,t,n){let o,{collection:s,session:r,content:c}=t;l(e,r,e=>{n("$session",o=e)});let u,i,a,p,m=pubgate_instance;const d=async e=>{let t=e.split("?"),r=t.shift();m&&t.push("cached=1"),n("collection",s=await ie(`${r}?${t.join("&")}`,o))};let f;return e.$set=(e=>{"collection"in e&&n("collection",s=e.collection),"session"in e&&n("session",r=e.session),"content"in e&&n("content",c=e.content)}),e.$$.update=((e={collection:1})=>{e.collection&&n("posts",f=(e=>{let t=/page=(\d+)$/.exec(e.id);return n("page",p=t?parseInt(t[1]):1),n("homeUrl",u=p>1&&e.partOf?e.partOf:null),n("prevUrl",i=p>1?`${u}?page=${p-1}`:null),n("nextUrl",a=e.next),e.first&&e.totalItems===e.first.totalItems&&n("nextUrl",a=null),e.first?e.first.orderedItems:e.orderedItems})(s))}),{collection:s,session:r,content:c,homeUrl:u,prevUrl:i,nextUrl:a,page:p,selectPage:d,posts:f,click_handler:function(){return d(u)},click_handler_1:function(){return d(i)},click_handler_2:function(){return d(a)}}}class Wt extends M{constructor(e){super(),H(this,e,Mt,Ht,c,["collection","session","content"])}}function zt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Gt(e){var t,n=new Wt({props:{collection:e.collection,session:e.session,content:Kt}});return{c(){n.$$.fragment.c()},m(e,o){J(n,e,o),t=!0},p(e,t){var o={};e.timeline&&(o.collection=t.collection),e.session&&(o.session=t.session),e.content&&(o.content=Kt),n.$set(o)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){E(n.$$.fragment,e),t=!1},d(e){B(n,e)}}}function Yt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Zt(e){var n,o,s;let r={ctx:e,current:null,token:null,pending:Yt,then:Gt,catch:zt,value:"collection",error:"null",blocks:[,,,]};return D(o=e.timeline,r),{c(){n=h(),r.block.c()},m(e,t){i(e,n,t),r.block.m(e,r.anchor=t),r.mount=(()=>n.parentNode),r.anchor=n,s=!0},p(n,s){e=s,r.ctx=e,"timeline"in n&&o!==(o=e.timeline)&&D(o,r)||r.block.p(n,t(t({},e),r.resolved))},i(e){s||(A(r.block),s=!0)},o(e){for(let e=0;e<3;e+=1){E(r.blocks[e])}s=!1},d(e){e&&a(n),r.block.d(e),r.token=null,r=null}}}let Kt="timeline";function Qt(e,t,n){let o,s,{curRoute:r}=t;l(e,r,e=>{n("$curRoute",o=e)});let{session:c}=t;l(e,c,e=>{n("$session",s=e)});let u=pubgate_instance;let i;return e.$set=(e=>{"curRoute"in e&&n("curRoute",r=e.curRoute),"session"in e&&n("session",c=e.session)}),e.$$.update=((e={$curRoute:1,$session:1})=>{(e.$curRoute||e.$session)&&n("timeline",i=function(e,t){switch(e){case"/local":return u?ie(base_url+"/timeline/local?cached=1"):[];case"/federated":return u?ie(base_url+"/timeline/federated?cached=1"):[];case"/inbox":return t.user?u?ie(t.user.inbox+"?cached=1",t,!0):ie(t.user.inbox,t):[];case"/profile":return ie(u?t.user.outbox+"?cached=1":t.user.outbox);default:return[]}}(o,s))}),{curRoute:r,session:c,timeline:i}}class Vt extends M{constructor(e){super(),H(this,e,Qt,Zt,c,["curRoute","session"])}}function Xt(e){var t,n,o,s,r,c,l,p,$,k,w,y,R,x=e.profile.name,_=e.profile.summary;function T(e){return e.following?tn:en}var j=T(e),P=j(e),S=e.outbox_collection&&nn(e);return{c(){t=m("h2"),n=d(x),o=f(),s=m("button"),P.c(),r=f(),c=m("span"),l=d(e.errorFollow),p=f(),$=d(_),k=f(),S&&S.c(),w=h(),b(s,"class","btn btn-sm pull-xs-right btn-info"),b(c,"class","error text-danger svelte-1y36edj"),R=g(s,"click",e.handleFollow)},m(e,a){i(e,t,a),u(t,n),u(t,o),u(t,s),P.m(s,null),u(t,r),u(t,c),u(c,l),i(e,p,a),i(e,$,a),i(e,k,a),S&&S.m(e,a),i(e,w,a),y=!0},p(e,t){y&&!e.profile||x===(x=t.profile.name)||v(n,x),j!==(j=T(t))&&(P.d(1),(P=j(t))&&(P.c(),P.m(s,null))),y&&!e.errorFollow||v(l,t.errorFollow),y&&!e.profile||_===(_=t.profile.summary)||v($,_),t.outbox_collection?S?(S.p(e,t),A(S,1)):((S=nn(t)).c(),A(S,1),S.m(w.parentNode,w)):S&&(I(),E(S,1,1,()=>{S=null}),F())},i(e){y||(A(S),y=!0)},o(e){E(S),y=!1},d(e){e&&a(t),P.d(),e&&(a(p),a($),a(k)),S&&S.d(e),e&&a(w),R()}}}function en(e){var t;return{c(){t=d("Follow")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function tn(e){var t;return{c(){t=d("Unfollow")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function nn(e){var t,n=new Wt({props:{session:e.session,collection:e.outbox_collection}});return{c(){n.$$.fragment.c()},m(e,o){J(n,e,o),t=!0},p(e,t){var o={};e.session&&(o.session=t.session),e.outbox_collection&&(o.collection=t.outbox_collection),n.$set(o)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){E(n.$$.fragment,e),t=!1},d(e){B(n,e)}}}function on(e){var t,n=new _t({props:{post:e.loadedPost,session:e.session}});return{c(){n.$$.fragment.c()},m(e,o){J(n,e,o),t=!0},p(e,t){var o={};e.loadedPost&&(o.post=t.loadedPost),e.session&&(o.session=t.session),n.$set(o)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){E(n.$$.fragment,e),t=!1},d(e){B(n,e)}}}function sn(e){var t,n,o,r,c,l,p,k,w,y,R,x,_,T,j,P,S,C,N,O,U,L,D,J,B,q,H,M,W,z,G,Y,Z,K,Q,V,X=e.profile&&Xt(e),ee="object"==typeof e.loadedPost&&on(e);return{c(){t=m("br"),n=d("\nSearch accounts\n"),o=m("form"),r=m("fieldset"),c=m("input"),l=f(),p=m("button"),k=d("Find User"),y=f(),R=m("span"),x=d(e.errorUser),_=f(),T=m("br"),j=f(),P=m("br"),S=d("\nLoad Post by link\n"),C=m("form"),N=m("fieldset"),O=m("input"),U=f(),L=m("button"),D=d("Find Post"),B=f(),q=m("span"),H=d(e.errorPost),M=f(),W=m("br"),z=f(),G=m("br"),Y=f(),X&&X.c(),Z=f(),ee&&ee.c(),K=h(),b(c,"class","form-control form-control-lg"),b(c,"type","text"),b(c,"placeholder","Format: username@domain"),b(r,"class","form-group"),b(p,"class","btn btn-sm pull-xs-right btn-info"),b(p,"type","submit"),p.disabled=w=!e.username,b(R,"class","error text-danger svelte-1y36edj"),b(O,"class","form-control form-control-lg"),b(O,"type","text"),b(O,"placeholder","Enter a link here"),b(N,"class","form-group"),b(L,"class","btn btn-sm pull-xs-right btn-info"),b(L,"type","submit"),L.disabled=J=!e.postLink,b(q,"class","error text-danger svelte-1y36edj"),V=[g(c,"input",e.input0_input_handler),g(o,"submit",$(e.handleSearchUser)),g(O,"input",e.input1_input_handler),g(C,"submit",$(e.handleSearchPost))]},m(s,a){i(s,t,a),i(s,n,a),i(s,o,a),u(o,r),u(r,c),c.value=e.username,u(o,l),u(o,p),u(p,k),u(o,y),u(o,R),u(R,x),i(s,_,a),i(s,T,a),i(s,j,a),i(s,P,a),i(s,S,a),i(s,C,a),u(C,N),u(N,O),O.value=e.postLink,u(C,U),u(C,L),u(L,D),u(C,B),u(C,q),u(q,H),i(s,M,a),i(s,W,a),i(s,z,a),i(s,G,a),i(s,Y,a),X&&X.m(s,a),i(s,Z,a),ee&&ee.m(s,a),i(s,K,a),Q=!0},p(e,t){e.username&&c.value!==t.username&&(c.value=t.username),Q&&!e.username||w===(w=!t.username)||(p.disabled=w),Q&&!e.errorUser||v(x,t.errorUser),e.postLink&&O.value!==t.postLink&&(O.value=t.postLink),Q&&!e.postLink||J===(J=!t.postLink)||(L.disabled=J),Q&&!e.errorPost||v(H,t.errorPost),t.profile?X?(X.p(e,t),A(X,1)):((X=Xt(t)).c(),A(X,1),X.m(Z.parentNode,Z)):X&&(I(),E(X,1,1,()=>{X=null}),F()),"object"==typeof t.loadedPost?ee?(ee.p(e,t),A(ee,1)):((ee=on(t)).c(),A(ee,1),ee.m(K.parentNode,K)):ee&&(I(),E(ee,1,1,()=>{ee=null}),F())},i(e){Q||(A(X),A(ee),Q=!0)},o(e){E(X),E(ee),Q=!1},d(e){e&&(a(t),a(n),a(o),a(_),a(T),a(j),a(P),a(S),a(C),a(M),a(W),a(z),a(G),a(Y)),X&&X.d(e),e&&a(Z),ee&&ee.d(e),e&&a(K),s(V)}}}function rn(e,t,n){let o,{session:s,curRoute:r}=t;l(e,s,e=>{n("$session",o=e)});let c="",u=null,i=!1,a=null,p="",m="",d="",f="",h="";return e.$set=(e=>{"session"in e&&n("session",s=e.session),"curRoute"in e&&n("curRoute",r=e.curRoute)}),{session:s,curRoute:r,username:c,profile:u,following:i,outbox_collection:a,loadedPost:p,postLink:m,errorUser:d,errorPost:f,errorFollow:h,handleSearchUser:async e=>{let t,o;n("errorUser",d=""),n("profile",u=null),n("outbox_collection",a=null);const s=c.split("@");if(c.match(/^http/)||2!==s.length||""===s[0]){var r=d="Use this format: username@domain";return n("errorUser",d),r}t=s[0],o=s[1];const l=await me(t,o);l?l.error&&n("errorUser",d=l.error):n("errorUser",d="Empty response."),l.outbox?(n("profile",u=l),n("errorFollow",h=""),n("outbox_collection",a="string"==typeof u.outbox?await ae(u.outbox):u.outbox)):n("errorUser",d=l.error||"User not found.")},handleSearchPost:async e=>{if(""===m||!m.match("^http"))return void n("errorPost",f="Not an URL.");n("errorPost",f=p=""),n("loadedPost",p);const t=await fe(m);if(t){if(t.error)return void n("errorPost",f=t.error)}else n("errorPost",f="Empty response.");n("loadedPost",p=t),n("postLink",m="")},handleFollow:async e=>{if(!o.user)return void n("errorFollow",h="You are not logged in.");const t=e.target.innerText,{id:s,name:r}=u,c=JSON.stringify({type:t,object:s}),l=await de(o,c);l?"success"===l.Created?n("following",i="Follow"===t):l.error?"This user is already followed"===l.error?n("following",i=!0):n("errorFollow",h=JSON.stringify(l.error)):n("errorFollow",h="Something went wrong."):n("errorFollow",h=`Empty response trying to ${t} ${r}`)},input0_input_handler:function(){c=this.value,n("username",c)},input1_input_handler:function(){m=this.value,n("postLink",m)}}}function cn(t){var n,o,r,c,l,p,h,k,w,y,R,x,_,T,j,P,S,C,N,O,U,L,I,F,A,E,D,J,B,q,H,M,W,z,G,Y,Z,K,Q,V,X,ee,te,ne,oe;return{c(){(n=m("div")).textContent="Sign-in ( ActivityPub compatible, OAuth2 password grant )",o=f(),r=m("form"),c=m("fieldset"),l=m("input"),p=f(),h=m("fieldset"),k=m("input"),w=f(),y=m("button"),R=d("Sign in"),_=f(),T=m("span"),j=d(t.errorLogin),P=f(),S=m("br"),C=f(),N=m("br"),O=d("\n  or register ( PubGate only )\n  "),U=m("br"),L=f(),I=m("form"),F=m("fieldset"),A=m("input"),E=f(),D=m("fieldset"),J=m("input"),B=f(),q=m("fieldset"),H=m("textarea"),M=f(),W=m("fieldset"),z=m("input"),G=f(),Y=m("fieldset"),Z=m("input"),K=f(),Q=m("button"),V=d("Register"),ee=f(),te=m("span"),ne=d(t.errorRegister),b(n,"class","form-group"),b(l,"class","form-control form-control-lg"),b(l,"type","username"),b(l,"placeholder","Username"),b(c,"class","form-group"),b(k,"class","form-control form-control-lg"),b(k,"type","password"),b(k,"placeholder","Password"),b(h,"class","form-group"),b(y,"class","btn btn-sm pull-xs-right btn-info"),b(y,"type","submit"),y.disabled=x=!t.username||!t.password,b(T,"class","text-danger"),b(A,"class","form-control form-control-lg"),b(A,"type","text"),b(A,"placeholder","Username"),b(F,"class","form-group"),b(J,"class","form-control form-control-lg"),b(J,"type","password"),b(J,"placeholder","Password"),b(D,"class","form-group"),b(H,"class","form-control"),b(H,"rows","8"),b(H,"placeholder","Profile Description"),b(q,"class","form-group"),b(z,"class","form-control form-control-lg"),b(z,"type","text"),b(z,"placeholder","Avatar URL"),b(W,"class","form-group"),b(Z,"class","form-control form-control-lg"),b(Z,"type","text"),b(Z,"placeholder","Invite code"),b(Y,"class","form-group"),b(Q,"class","btn btn-sm pull-xs-right btn-info"),b(Q,"type","submit"),Q.disabled=X=!t.username||!t.password,b(te,"class","text-danger"),oe=[g(l,"input",t.input0_input_handler),g(k,"input",t.input1_input_handler),g(r,"submit",$(t.login)),g(A,"input",t.input2_input_handler),g(J,"input",t.input3_input_handler),g(H,"input",t.textarea_input_handler),g(z,"input",t.input4_input_handler),g(Z,"input",t.input5_input_handler),g(I,"submit",$(t.register))]},m(e,s){i(e,n,s),i(e,o,s),i(e,r,s),u(r,c),u(c,l),l.value=t.username,u(r,p),u(r,h),u(h,k),k.value=t.password,u(r,w),u(r,y),u(y,R),u(r,_),u(r,T),u(T,j),i(e,P,s),i(e,S,s),i(e,C,s),i(e,N,s),i(e,O,s),i(e,U,s),i(e,L,s),i(e,I,s),u(I,F),u(F,A),A.value=t.username,u(I,E),u(I,D),u(D,J),J.value=t.password,u(I,B),u(I,q),u(q,H),H.value=t.summary,u(I,M),u(I,W),u(W,z),z.value=t.avatar,u(I,G),u(I,Y),u(Y,Z),Z.value=t.invite,u(I,K),u(I,Q),u(Q,V),u(I,ee),u(I,te),u(te,ne)},p(e,t){e.username&&(l.value=t.username),e.password&&k.value!==t.password&&(k.value=t.password),(e.username||e.password)&&x!==(x=!t.username||!t.password)&&(y.disabled=x),e.errorLogin&&v(j,t.errorLogin),e.username&&A.value!==t.username&&(A.value=t.username),e.password&&J.value!==t.password&&(J.value=t.password),e.summary&&(H.value=t.summary),e.avatar&&z.value!==t.avatar&&(z.value=t.avatar),e.invite&&Z.value!==t.invite&&(Z.value=t.invite),(e.username||e.password)&&X!==(X=!t.username||!t.password)&&(Q.disabled=X),e.errorRegister&&v(ne,t.errorRegister)},i:e,o:e,d(e){e&&(a(n),a(o),a(r),a(P),a(S),a(C),a(N),a(O),a(U),a(L),a(I)),s(oe)}}}function ln(e){var t,n,o,s,r,c,l,p,h,$,k,w=e.$session.user.name,y=e.$session.user.summary,R=new Vt({props:{curRoute:e.curRoute,session:e.session}});return{c(){t=m("h2"),n=m("a"),o=d(w),r=f(),(c=m("button")).textContent="Logout",l=f(),p=d(y),h=f(),R.$$.fragment.c(),b(n,"href",s=e.$session.user.url),b(c,"class","btn btn-sm pull-xs-right btn-info"),k=g(c,"click",e.logout)},m(e,s){i(e,t,s),u(t,n),u(n,o),u(t,r),u(t,c),i(e,l,s),i(e,p,s),i(e,h,s),J(R,e,s),$=!0},p(e,t){$&&!e.$session||w===(w=t.$session.user.name)||v(o,w),$&&!e.$session||s===(s=t.$session.user.url)||b(n,"href",s),$&&!e.$session||y===(y=t.$session.user.summary)||v(p,y);var r={};e.curRoute&&(r.curRoute=t.curRoute),e.session&&(r.session=t.session),R.$set(r)},i(e){$||(A(R.$$.fragment,e),$=!0)},o(e){E(R.$$.fragment,e),$=!1},d(e){e&&(a(t),a(l),a(p),a(h)),B(R,e),k()}}}function un(e){var t,n,o,s,r=[ln,cn],c=[];function l(e){return e.$session.user?0:1}return t=l(e),n=c[t]=r[t](e),{c(){n.c(),o=h()},m(e,n){c[t].m(e,n),i(e,o,n),s=!0},p(e,s){var u=t;(t=l(s))===u?c[t].p(e,s):(I(),E(c[u],1,1,()=>{c[u]=null}),F(),(n=c[t])||(n=c[t]=r[t](s)).c(),A(n,1),n.m(o.parentNode,o))},i(e){s||(A(n),s=!0)},o(e){E(n),s=!1},d(e){c[t].d(e),e&&a(o)}}}function an(e,t,n){let o;const s=R();let{curRoute:r,session:c}=t;l(e,c,e=>{n("$session",o=e)});let u="",i="",a="",p="",m="",d="",f="";const h=async e=>{n("errorLogin",d=""),console.log("loggin in");const t=await le(base_url+"/@"+u).catch(e=>console.log("login failed",e));if(!t)return void n("errorLogin",d="login failed");if(t.error)return void n("errorLogin",d=t.error);if(console.log("login result",t),!t.endpoints)return void console.log("BUG profile.endpoints doesn't exist.");console.log("fetching token",t.endpoints.oauthTokenEndpoint);const r=t.endpoints.oauthTokenEndpoint,c=JSON.stringify({username:u,password:i}),l=await le(r,{method:"POST",body:c});if(l.access_token){let e=o;e.user=t,e.token=l.access_token,s("updatesession",e)}else console.log("token result",l)};return e.$set=(e=>{"curRoute"in e&&n("curRoute",r=e.curRoute),"session"in e&&n("session",c=e.session)}),{curRoute:r,session:c,username:u,password:i,summary:a,avatar:p,invite:m,errorLogin:d,errorRegister:f,login:h,logout:async e=>s("updatesession",{}),register:async e=>{const t={type:"Person",name:u,summary:a,icon:{type:"Image",mediaType:"image/jpeg",url:p}},o=JSON.stringify({username:u,password:i,invite:m,profile:t}),s=await le(base_url+"/user",{method:"POST",body:o});s.profile?await h():s.error?n("errorRegister",f=s.error):console.log("register failed:",s)},$session:o,input0_input_handler:function(){u=this.value,n("username",u)},input1_input_handler:function(){i=this.value,n("password",i)},input2_input_handler:function(){u=this.value,n("username",u)},input3_input_handler:function(){i=this.value,n("password",i)},textarea_input_handler:function(){a=this.value,n("summary",a)},input4_input_handler:function(){p=this.value,n("avatar",p)},input5_input_handler:function(){m=this.value,n("invite",m)}}}function pn(t){var n;return{c(){n=d("Minimalist blogging ActivityPub client made with Svelte Could be deployed as\nextension for PubGate, or connected to remote instance Github repo\nhttps://github.com/autogestion/pubgate-philip")},m(e,t){i(e,n,t)},p:e,i:e,o:e,d(e){e&&a(n)}}}function mn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function dn(e){var n,o,s,r,c,l,p,g,$,k,w,y,R,x,_,T,j,P,S,C,N,O,U,L,I,F,J,B,q,H,M,W,z,G,Y=e.user.name,Z=e.user.summary;let K={ctx:e,current:null,token:null,pending:$n,then:hn,catch:fn,value:"collection",error:"null",blocks:[,,,]};D(F=e.followers,K);let Q={ctx:e,current:null,token:null,pending:wn,then:vn,catch:bn,value:"collection",error:"null",blocks:[,,,]};D(B=e.following,Q);let V={ctx:e,current:null,token:null,pending:_n,then:Rn,catch:yn,value:"collection",error:"null",blocks:[,,,]};D(H=e.liked,V);let X={ctx:e,current:null,token:null,pending:Pn,then:jn,catch:Tn,value:"collection",error:"null",blocks:[,,,]};return D(z=e.outbox,X),{c(){n=m("h2"),o=m("a"),s=d(Y),c=f(),l=m("p"),p=m("a"),g=d("Followers"),k=d("\n    |\n    "),w=m("a"),y=d("Following"),x=d("\n    |\n    "),_=m("a"),T=d("Timeline"),P=d("\n    |\n    "),S=m("a"),C=d("Liked"),O=f(),U=m("p"),L=d(Z),I=f(),K.block.c(),J=f(),Q.block.c(),q=f(),V.block.c(),M=f(),W=h(),X.block.c(),b(o,"href",r=e.user.url),b(p,"href",$=e.user.followers),b(w,"href",R=e.user.following),b(_,"href",j=e.user.outbox),b(S,"href",N=e.user.liked)},m(e,t){i(e,n,t),u(n,o),u(o,s),i(e,c,t),i(e,l,t),u(l,p),u(p,g),u(l,k),u(l,w),u(w,y),u(l,x),u(l,_),u(_,T),u(l,P),u(l,S),u(S,C),i(e,O,t),i(e,U,t),u(U,L),i(e,I,t),K.block.m(e,K.anchor=t),K.mount=(()=>J.parentNode),K.anchor=J,i(e,J,t),Q.block.m(e,Q.anchor=t),Q.mount=(()=>q.parentNode),Q.anchor=q,i(e,q,t),V.block.m(e,V.anchor=t),V.mount=(()=>M.parentNode),V.anchor=M,i(e,M,t),i(e,W,t),X.block.m(e,X.anchor=t),X.mount=(()=>W.parentNode),X.anchor=W,G=!0},p(n,c){e=c,G&&!n.profile||Y===(Y=e.user.name)||v(s,Y),G&&!n.profile||r===(r=e.user.url)||b(o,"href",r),G&&!n.profile||$===($=e.user.followers)||b(p,"href",$),G&&!n.profile||R===(R=e.user.following)||b(w,"href",R),G&&!n.profile||j===(j=e.user.outbox)||b(_,"href",j),G&&!n.profile||N===(N=e.user.liked)||b(S,"href",N),G&&!n.profile||Z===(Z=e.user.summary)||v(L,Z),K.ctx=e,"followers"in n&&F!==(F=e.followers)&&D(F,K)||K.block.p(n,t(t({},e),K.resolved)),Q.ctx=e,"following"in n&&B!==(B=e.following)&&D(B,Q)||Q.block.p(n,t(t({},e),Q.resolved)),V.ctx=e,"liked"in n&&H!==(H=e.liked)&&D(H,V)||V.block.p(n,t(t({},e),V.resolved)),X.ctx=e,"outbox"in n&&z!==(z=e.outbox)&&D(z,X)||X.block.p(n,t(t({},e),X.resolved))},i(e){G||(A(K.block),A(Q.block),A(V.block),A(X.block),G=!0)},o(e){for(let e=0;e<3;e+=1){E(K.blocks[e])}for(let e=0;e<3;e+=1){E(Q.blocks[e])}for(let e=0;e<3;e+=1){E(V.blocks[e])}for(let e=0;e<3;e+=1){E(X.blocks[e])}G=!1},d(e){e&&(a(n),a(c),a(l),a(O),a(U),a(I)),K.block.d(e),K.token=null,K=null,e&&a(J),Q.block.d(e),Q.token=null,Q=null,e&&a(q),V.block.d(e),V.token=null,V=null,e&&(a(M),a(W)),X.block.d(e),X.token=null,X=null}}}function fn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function hn(e){var t,n,o=e.collection.length&&gn(e);return{c(){o&&o.c(),t=h()},m(e,s){o&&o.m(e,s),i(e,t,s),n=!0},p(e,n){n.collection.length?o?(o.p(e,n),A(o,1)):((o=gn(n)).c(),A(o,1),o.m(t.parentNode,t)):o&&(I(),E(o,1,1,()=>{o=null}),F())},i(e){n||(A(o),n=!0)},o(e){E(o),n=!1},d(e){o&&o.d(e),e&&a(t)}}}function gn(e){var t,n,o,s=new Wt({props:{session:e.session,collection:e.collection}});return{c(){(t=m("h3")).textContent="Followers",n=f(),s.$$.fragment.c()},m(e,r){i(e,t,r),i(e,n,r),J(s,e,r),o=!0},p(e,t){var n={};e.session&&(n.session=t.session),e.followers&&(n.collection=t.collection),s.$set(n)},i(e){o||(A(s.$$.fragment,e),o=!0)},o(e){E(s.$$.fragment,e),o=!1},d(e){e&&(a(t),a(n)),B(s,e)}}}function $n(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function bn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function vn(e){var t,n,o=e.collection.length&&kn(e);return{c(){o&&o.c(),t=h()},m(e,s){o&&o.m(e,s),i(e,t,s),n=!0},p(e,n){n.collection.length?o?(o.p(e,n),A(o,1)):((o=kn(n)).c(),A(o,1),o.m(t.parentNode,t)):o&&(I(),E(o,1,1,()=>{o=null}),F())},i(e){n||(A(o),n=!0)},o(e){E(o),n=!1},d(e){o&&o.d(e),e&&a(t)}}}function kn(e){var t,n,o,s=new Wt({props:{session:e.session,collection:e.collection}});return{c(){(t=m("h3")).textContent="Following",n=f(),s.$$.fragment.c()},m(e,r){i(e,t,r),i(e,n,r),J(s,e,r),o=!0},p(e,t){var n={};e.session&&(n.session=t.session),e.following&&(n.collection=t.collection),s.$set(n)},i(e){o||(A(s.$$.fragment,e),o=!0)},o(e){E(s.$$.fragment,e),o=!1},d(e){e&&(a(t),a(n)),B(s,e)}}}function wn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function yn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Rn(e){var t,n,o=e.collection.length&&xn(e);return{c(){o&&o.c(),t=h()},m(e,s){o&&o.m(e,s),i(e,t,s),n=!0},p(e,n){n.collection.length?o?(o.p(e,n),A(o,1)):((o=xn(n)).c(),A(o,1),o.m(t.parentNode,t)):o&&(I(),E(o,1,1,()=>{o=null}),F())},i(e){n||(A(o),n=!0)},o(e){E(o),n=!1},d(e){o&&o.d(e),e&&a(t)}}}function xn(e){var t,n,o,s=new Wt({props:{session:e.session,collection:e.collection}});return{c(){(t=m("h3")).textContent="Liked",n=f(),s.$$.fragment.c()},m(e,r){i(e,t,r),i(e,n,r),J(s,e,r),o=!0},p(e,t){var n={};e.session&&(n.session=t.session),e.liked&&(n.collection=t.collection),s.$set(n)},i(e){o||(A(s.$$.fragment,e),o=!0)},o(e){E(s.$$.fragment,e),o=!1},d(e){e&&(a(t),a(n)),B(s,e)}}}function _n(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Tn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function jn(e){var t,n,o,s=new Wt({props:{session:e.session,collection:e.collection}});return{c(){(t=m("h3")).textContent="Posts",n=f(),s.$$.fragment.c()},m(e,r){i(e,t,r),i(e,n,r),J(s,e,r),o=!0},p(e,t){var n={};e.session&&(n.session=t.session),e.outbox&&(n.collection=t.collection),s.$set(n)},i(e){o||(A(s.$$.fragment,e),o=!0)},o(e){E(s.$$.fragment,e),o=!1},d(e){e&&(a(t),a(n)),B(s,e)}}}function Pn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Sn(t){var n,o,s;return{c(){n=d("Shortly this page will show info about\n  "),o=m("b"),s=d(t.username)},m(e,t){i(e,n,t),i(e,o,t),u(o,s)},p:e,i:e,o:e,d(e){e&&(a(n),a(o))}}}function Cn(e){var n,o,s;let r={ctx:e,current:null,token:null,pending:Sn,then:dn,catch:mn,value:"user",error:"null",blocks:[,,,]};return D(o=e.profile,r),{c(){n=h(),r.block.c()},m(e,t){i(e,n,t),r.block.m(e,r.anchor=t),r.mount=(()=>n.parentNode),r.anchor=n,s=!0},p(n,s){e=s,r.ctx=e,"profile"in n&&o!==(o=e.profile)&&D(o,r)||r.block.p(n,t(t({},e),r.resolved))},i(e){s||(A(r.block),s=!0)},o(e){for(let e=0;e<3;e+=1){E(r.blocks[e])}s=!1},d(e){e&&a(n),r.block.d(e),r.token=null,r=null}}}function Nn(e,t,n){let o,{curRoute:s,session:r}=t;l(e,s,e=>{n("$curRoute",o=e)});const c=o.match(/^\/@([^\/]+)$/)[1];let u,i,a,p;let m;return e.$set=(e=>{"curRoute"in e&&n("curRoute",s=e.curRoute),"session"in e&&n("session",r=e.session)}),e.$$.update=((e={$curRoute:1})=>{e.$curRoute&&n("profile",m=(async e=>{const t=await re(e);return console.log("[User] Fetching timeline",t.outbox),n("outbox",u=re(t.outbox)),n("followers",i=re(t.followers)),n("following",a=re(t.following)),n("liked",p=re(t.liked)),t})(base_url+o))}),{curRoute:s,session:r,username:c,outbox:u,followers:i,following:a,liked:p,profile:m}}function On(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Un(e){var t,n=new _t({props:{post:e.post,session:e.session,showComments:Fn}});return{c(){n.$$.fragment.c()},m(e,o){J(n,e,o),t=!0},p(e,t){var o={};e.object&&(o.post=t.post),e.session&&(o.session=t.session),e.showComments&&(o.showComments=Fn),n.$set(o)},i(e){t||(A(n.$$.fragment,e),t=!0)},o(e){E(n.$$.fragment,e),t=!1},d(e){B(n,e)}}}function Ln(t){var n,o,s;return{c(){n=d("So you want to see object "),o=d(t.id),s=d("?")},m(e,t){i(e,n,t),i(e,o,t),i(e,s,t)},p:e,i:e,o:e,d(e){e&&(a(n),a(o),a(s))}}}function In(e){var n,o,s;let r={ctx:e,current:null,token:null,pending:Ln,then:Un,catch:On,value:"post",error:"null",blocks:[,,,]};return D(o=e.object,r),{c(){n=h(),r.block.c()},m(e,t){i(e,n,t),r.block.m(e,r.anchor=t),r.mount=(()=>n.parentNode),r.anchor=n,s=!0},p(n,s){e=s,r.ctx=e,"object"in n&&o!==(o=e.object)&&D(o,r)||r.block.p(n,t(t({},e),r.resolved))},i(e){s||(A(r.block),s=!0)},o(e){for(let e=0;e<3;e+=1){E(r.blocks[e])}s=!1},d(e){e&&a(n),r.block.d(e),r.token=null,r=null}}}let Fn=!0;function An(e,t,n){let o,{curRoute:s,session:r}=t;l(e,s,e=>{n("$curRoute",o=e)});let c,u=pubgate_instance,i=o.match(/^\/@([^\/]+)\/object\/(.+)$/)[2],a=u?o+"?cached=1":o;return e.$set=(e=>{"curRoute"in e&&n("curRoute",s=e.curRoute),"session"in e&&n("session",r=e.session)}),e.$$.update=((e={route:1})=>{e.route&&n("object",c=le(base_url+a))}),{curRoute:s,session:r,id:i,object:c}}function En(t){var n,o,s;return{c(){n=d("You wanted to see "),o=d(t.$curRoute),s=d(" but we don't have it :/")},m(e,t){i(e,n,t),i(e,o,t),i(e,s,t)},p(e,t){e.$curRoute&&v(o,t.$curRoute)},i:e,o:e,d(e){e&&(a(n),a(o),a(s))}}}function Dn(e,t,n){let o,{curRoute:s,session:r}=t;return l(e,s,e=>{n("$curRoute",o=e)}),e.$set=(e=>{"curRoute"in e&&n("curRoute",s=e.curRoute),"session"in e&&n("session",r=e.session)}),{curRoute:s,session:r,$curRoute:o}}const Jn=[];function Bn(t,n=e){let o;const s=[];function r(e){if(c(t,e)&&(t=e,o)){const e=!Jn.length;for(let e=0;e<s.length;e+=1){const n=s[e];n[1](),Jn.push(n,t)}if(e){for(let e=0;e<Jn.length;e+=2)Jn[e][0](Jn[e+1]);Jn.length=0}}}return{set:r,update:function(e){r(e(t))},subscribe:function(c,l=e){const u=[c,l];return s.push(u),1===s.length&&(o=n(r)||e),c(t),()=>{const e=s.indexOf(u);-1!==e&&s.splice(e,1),0===s.length&&(o(),o=null)}}}}const qn=Bn(window.location.pathname),Hn={"/local":{name:"Local Timeline",component:Vt},"/federated":{name:"Federated Timeline",component:Vt},"/create":{name:"Create",component:tt},"/search":{name:"Search",component:class extends M{constructor(e){super(),H(this,e,rn,sn,c,["session","curRoute"])}}},"/inbox":{name:"Inbox",component:Vt},"/profile":{name:"Profile",component:class extends M{constructor(e){super(),H(this,e,an,un,c,["curRoute","session"])}}},"/about":{name:"About",component:class extends M{constructor(e){super(),H(this,e,null,pn,c,[])}}},user:{component:class extends M{constructor(e){super(),H(this,e,Nn,Cn,c,["curRoute","session"])}}},object:{component:class extends M{constructor(e){super(),H(this,e,An,In,c,["curRoute","session"])}}},error:{component:class extends M{constructor(e){super(),H(this,e,Dn,En,c,["curRoute","session"])}}}},Mn=Bn({});function Wn(e){var t,n,o=e.component;function s(e){return{props:{curRoute:e.curRoute,session:e.session}}}if(o){var r=new o(s(e));r.$on("updatesession",e.updateSession)}return{c(){t=m("div"),r&&r.$$.fragment.c(),b(t,"class","content")},m(e,o){i(e,t,o),r&&J(r,t,null),n=!0},p(e,n){var c={};if(e.curRoute&&(c.curRoute=n.curRoute),e.session&&(c.session=n.session),o!==(o=n.component)){if(r){I();const e=r;E(e.$$.fragment,1,0,()=>{B(e,1)}),F()}o?((r=new o(s(n))).$on("updatesession",n.updateSession),r.$$.fragment.c(),A(r.$$.fragment,1),J(r,t,null)):r=null}else o&&r.$set(c)},i(e){n||(r&&A(r.$$.fragment,e),n=!0)},o(e){r&&E(r.$$.fragment,e),n=!1},d(e){e&&a(t),r&&B(r)}}}function zn(e,t,n){let o,{routes:s,curRoute:r}=t;l(e,r,e=>{n("$curRoute",o=e)}),"/"===o&&r.set("/local");let c,{updateSession:u,session:i}=t;return y(r.subscribe(e=>{const t=s[o];let r=o.match(/^\/@([^\/]+)\/object\/(.+)$/),l=o.match(/^\/@([^\/]+)\/?$/);t?n("component",c=t.component):r?n("component",c=s.object.component):l&&n("component",c=s.user.component),c||n("component",c=s.error.component)})),e.$set=(e=>{"routes"in e&&n("routes",s=e.routes),"curRoute"in e&&n("curRoute",r=e.curRoute),"updateSession"in e&&n("updateSession",u=e.updateSession),"session"in e&&n("session",i=e.session)}),{routes:s,curRoute:r,updateSession:u,session:i,component:c}}class Gn extends M{constructor(e){super(),H(this,e,zn,Wn,c,["routes","curRoute","updateSession","session"])}}function Yn(e){var t,n,o,s=new V({props:{routes:Hn,curRoute:qn,selectTab:Zn,session:Mn,pgi:e.pgi}}),r=new Gn({props:{routes:Hn,curRoute:qn,session:Mn,updateSession:e.updateSession}}),c=new ee({});return{c(){s.$$.fragment.c(),t=f(),r.$$.fragment.c(),n=f(),c.$$.fragment.c()},m(e,l){J(s,e,l),i(e,t,l),J(r,e,l),i(e,n,l),J(c,e,l),o=!0},p(e,t){var n={};e.routes&&(n.routes=Hn),e.curRoute&&(n.curRoute=qn),e.selectTab&&(n.selectTab=Zn),e.session&&(n.session=Mn),e.pgi&&(n.pgi=t.pgi),s.$set(n);var o={};e.routes&&(o.routes=Hn),e.curRoute&&(o.curRoute=qn),e.session&&(o.session=Mn),e.updateSession&&(o.updateSession=t.updateSession),r.$set(o)},i(e){o||(A(s.$$.fragment,e),A(r.$$.fragment,e),A(c.$$.fragment,e),o=!0)},o(e){E(s.$$.fragment,e),E(r.$$.fragment,e),E(c.$$.fragment,e),o=!1},d(e){B(s,e),e&&a(t),B(r,e),e&&a(n),B(c,e)}}}function Zn(e){const t=e.pathname;Array.prototype.forEach.call(e.parentNode.parentNode.children,(e,n)=>{e.firstChild.href.split("/")[1]!==t&&e.firstChild.classList.remove("header-selected")}),e.classList.add("header-selected")}function Kn(e,t,n){let o;l(e,Mn,e=>{n("$session",o=e)});let s=pubgate_instance;const r=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))};return Mn.set((e=>JSON.parse(localStorage.getItem(e)))("session")||{}),{pgi:s,updateSession:e=>{Mn.set(e.detail),r("session",o)}}}return new class extends M{constructor(e){super(),H(this,e,Kn,Yn,c,[])}}({target:document.body,props:{name:"app"}})}();
//# sourceMappingURL=bundle.js.map
